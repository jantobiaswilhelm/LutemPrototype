<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lutem MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.3s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .loading.show {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e0e0e0;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .loading-tip {
            color: #666;
            font-style: italic;
            min-height: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        .game-title {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .feedback {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .feedback button {
            width: auto;
            padding: 10px 20px;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® Lutem</h1>
        
        <div class="form-group">
            <label for="minutes">Available Time (minutes)</label>
            <input type="number" id="minutes" min="5" max="180" value="30">
        </div>
        
        <div class="form-group">
            <label for="mood">Desired Mood</label>
            <select id="mood">
                <option value="relax">Relax</option>
                <option value="focus">Focus</option>
                <option value="challenge">Challenge</option>
            </select>
        </div>
        
        <button id="recommendBtn" onclick="getRecommendation()">Get Recommendation</button>
        
        <!-- Loading Spinner -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">Finding your perfect game...</div>
            <div class="loading-tip" id="loadingTip">ðŸŽ® Gaming tip will appear here</div>
        </div>
        
        <!-- Result -->
        <div class="result" id="result">
            <div class="game-title" id="gameTitle"></div>
            <p id="reason"></p>
            <p><strong>Time:</strong> <span id="gameTime"></span></p>
            <p><strong>Mood:</strong> <span id="gameMood"></span></p>
            
            <div class="feedback">
                <p style="flex: 1;">Rate your satisfaction:</p>
                <button onclick="submitFeedback(1)">1</button>
                <button onclick="submitFeedback(2)">2</button>
                <button onclick="submitFeedback(3)">3</button>
                <button onclick="submitFeedback(4)">4</button>
                <button onclick="submitFeedback(5)">5</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080';
        let currentGameId = null;
        let tipInterval = null;
        
        // Gaming tips to show during loading
        const gamingTips = [
            "ðŸ’¡ Short gaming sessions can be more satisfying than long ones!",
            "ðŸŽ¯ Playing games that match your mood improves enjoyment by 40%",
            "ðŸ§˜ Relaxing games before bed can improve sleep quality",
            "âš¡ Quick puzzle games are perfect for mental breaks",
            "ðŸŽ® Roguelikes offer maximum satisfaction in minimal time",
            "ðŸŒŸ The best game is one that fits your available time",
            "ðŸ’ª Challenge games work best when you're mentally fresh",
            "ðŸ”„ Variety in gaming moods prevents burnout",
            "â° Gaming in 30-minute chunks can boost productivity",
            "ðŸŽ¨ Creative games are great for afternoon mental resets"
        ];
        
        function showLoading() {
            // Hide result, show loading
            document.getElementById('result').classList.remove('show');
            document.getElementById('loading').classList.add('show');
            document.getElementById('recommendBtn').disabled = true;
            
            // Start rotating tips
            let tipIndex = 0;
            document.getElementById('loadingTip').textContent = gamingTips[tipIndex];
            
            tipInterval = setInterval(() => {
                tipIndex = (tipIndex + 1) % gamingTips.length;
                document.getElementById('loadingTip').textContent = gamingTips[tipIndex];
            }, 2500); // Change tip every 2.5 seconds
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
            document.getElementById('recommendBtn').disabled = false;
            
            // Stop rotating tips
            if (tipInterval) {
                clearInterval(tipInterval);
                tipInterval = null;
            }
        }
        
        async function getRecommendation() {
            const minutes = document.getElementById('minutes').value;
            const mood = document.getElementById('mood').value;
            
            showLoading();
            
            try {
                const response = await fetch(`${API_URL}/recommendations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        availableMinutes: parseInt(minutes),
                        desiredMood: mood
                    })
                });
                
                const data = await response.json();
                hideLoading();
                displayRecommendation(data);
            } catch (error) {
                hideLoading();
                alert('Error connecting to backend. Make sure it\'s running!');
                console.error(error);
            }
        }
        
        function displayRecommendation(data) {
            currentGameId = data.game.id;
            
            document.getElementById('gameTitle').textContent = data.game.name;
            document.getElementById('reason').textContent = data.reason;
            document.getElementById('gameTime').textContent = 
                `${data.game.minMinutes}-${data.game.maxMinutes} minutes`;
            document.getElementById('gameMood').textContent = 
                data.game.moodTags.join(', ');
            
            document.getElementById('result').classList.add('show');
        }
        
        async function submitFeedback(score) {
            if (!currentGameId) return;
            
            try {
                await fetch(`${API_URL}/sessions/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        gameId: currentGameId,
                        satisfactionScore: score
                    })
                });
                
                alert(`Thanks for your feedback! (${score}/5)`);
            } catch (error) {
                alert('Error submitting feedback');
                console.error(error);
            }
        }
    </script>
</body>
</html>
