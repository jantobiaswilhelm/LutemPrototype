<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lutem MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Time slider styles */
        .time-display {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #667eea 0%, #764ba2 100%);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 10px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
            transition: transform 0.2s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
            transition: transform 0.2s;
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }
        
        .time-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Touch Grass Popup */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-emoji {
            font-size: 5rem;
            margin-bottom: 20px;
        }
        
        .modal h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .modal p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal button {
            width: auto;
            padding: 12px 30px;
            margin: 5px;
        }

        
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.3s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
            padding: 30px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .loading.show {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e0e0e0;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .loading-tip {
            color: #666;
            font-style: italic;
            min-height: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        .game-title {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .feedback {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .feedback button {
            width: auto;
            padding: 10px 20px;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Lutem</h1>
        
        <div class="form-group">
            <label for="minutes">Available Time</label>
            <div class="time-display" id="timeDisplay">30 minutes</div>
            <input type="range" id="minutes" min="0" max="7" value="2" step="1" class="slider">
            <div class="time-labels">
                <span>5min</span>
                <span>15min</span>
                <span>30min</span>
                <span>45min</span>
                <span>1hr</span>
                <span>2hr</span>
                <span>3hr</span>
                <span>3hr+</span>
            </div>
        </div>
        
        <div class="form-group">
            <label for="mood">Desired Mood</label>
            <select id="mood">
                <option value="relax">Relax</option>
                <option value="focus">Focus</option>
                <option value="challenge">Challenge</option>
            </select>
        </div>
        
        <button id="recommendBtn" onclick="getRecommendation()">Get Recommendation</button>
        
        <!-- Loading Spinner -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">Finding your perfect game...</div>
            <div class="loading-tip" id="loadingTip">üéÆ Gaming tip will appear here</div>
        </div>
        
        <!-- Result -->
        <div class="result" id="result">
            <div class="game-title" id="gameTitle"></div>
            <p id="reason"></p>
            <p><strong>Time:</strong> <span id="gameTime"></span></p>
            <p><strong>Mood:</strong> <span id="gameMood"></span></p>
            
            <div class="feedback">
                <p style="flex: 1;">Rate your satisfaction:</p>
                <button onclick="submitFeedback(1)">1</button>
                <button onclick="submitFeedback(2)">2</button>
                <button onclick="submitFeedback(3)">3</button>
                <button onclick="submitFeedback(4)">4</button>
                <button onclick="submitFeedback(5)">5</button>
            </div>
        </div>
    </div>
    
    <!-- Touch Grass Modal -->
    <div class="modal-overlay" id="touchGrassModal">
        <div class="modal">
            <div class="modal-emoji">üå±‚òÄÔ∏è</div>
            <h2>Time to Touch Grass!</h2>
            <p>Hey gamer! 3+ hours is a marathon session. Remember to take breaks, stay hydrated, and maybe step outside for a bit! üéÆüíö</p>
            <p><strong>Pro tip:</strong> Your best gaming happens when you're well-rested and refreshed!</p>
            <button onclick="closeModal()">Got it! üëç</button>
            <button onclick="closeModalAndAdjust()">Change Time üïê</button>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080';
        const MIN_LOADING_TIME = 1200; // Minimum time to show loading (ms)
        let currentGameId = null;
        let tipInterval = null;
        let loadingStartTime = null;
        
        // Time step values (in minutes)
        const TIME_STEPS = [
            { value: 5, label: '5 minutes' },
            { value: 15, label: '15 minutes' },
            { value: 30, label: '30 minutes' },
            { value: 45, label: '45 minutes' },
            { value: 60, label: '1 hour' },
            { value: 120, label: '2 hours' },
            { value: 180, label: '3 hours' },
            { value: 999, label: '3+ hours üå±' } // Special value for marathon sessions
        ];
        
        // Update time display when slider changes
        function updateTimeDisplay() {
            const slider = document.getElementById('minutes');
            const display = document.getElementById('timeDisplay');
            const stepIndex = parseInt(slider.value);
            const timeStep = TIME_STEPS[stepIndex];
            
            display.textContent = timeStep.label;
            
            // Show "touch grass" modal if 3+ hours selected
            if (timeStep.value === 999) {
                showTouchGrassModal();
            }
        }
        
        // Show the touch grass modal
        function showTouchGrassModal() {
            document.getElementById('touchGrassModal').classList.add('show');
        }
        
        // Close modal and keep 3+ hours selection
        function closeModal() {
            document.getElementById('touchGrassModal').classList.remove('show');
        }
        
        // Close modal and reset to 3 hours
        function closeModalAndAdjust() {
            document.getElementById('touchGrassModal').classList.remove('show');
            const slider = document.getElementById('minutes');
            slider.value = 6; // Index 6 = 3 hours
            updateTimeDisplay();
        }
        
        // Get current minutes value from slider
        function getCurrentMinutes() {
            const slider = document.getElementById('minutes');
            const stepIndex = parseInt(slider.value);
            return TIME_STEPS[stepIndex].value;
        }
        
        // Initialize slider on page load
        document.addEventListener('DOMContentLoaded', function() {
            const slider = document.getElementById('minutes');
            
            // Update display when slider changes
            slider.addEventListener('input', updateTimeDisplay);
            
            // Set initial display
            updateTimeDisplay();
        });
        
        // Gaming tips to show during loading
        const gamingTips = [
            "üí° Short gaming sessions can be more satisfying than long ones!",
            "üéØ Playing games that match your mood improves enjoyment by 40%",
            "üßò Relaxing games before bed can improve sleep quality",
            "‚ö° Quick puzzle games are perfect for mental breaks",
            "üéÆ Roguelikes offer maximum satisfaction in minimal time",
            "üåü The best game is one that fits your available time",
            "üí™ Challenge games work best when you're mentally fresh",
            "üîÑ Variety in gaming moods prevents burnout",
            "‚è∞ Gaming in 30-minute chunks can boost productivity",
            "üé® Creative games are great for afternoon mental resets"
        ];
        
        function showLoading() {
            // Track when loading started
            loadingStartTime = Date.now();
            
            // Hide result, show loading
            document.getElementById('result').classList.remove('show');
            document.getElementById('loading').classList.add('show');
            document.getElementById('recommendBtn').disabled = true;
            
            // Start rotating tips
            let tipIndex = 0;
            document.getElementById('loadingTip').textContent = gamingTips[tipIndex];
            
            tipInterval = setInterval(() => {
                tipIndex = (tipIndex + 1) % gamingTips.length;
                document.getElementById('loadingTip').textContent = gamingTips[tipIndex];
            }, 2500); // Change tip every 2.5 seconds
        }
        
        async function hideLoading() {
            // Calculate how long loading has been shown
            const elapsedTime = Date.now() - loadingStartTime;
            const remainingTime = Math.max(0, MIN_LOADING_TIME - elapsedTime);
            
            // Wait for minimum display time if needed
            if (remainingTime > 0) {
                await new Promise(resolve => setTimeout(resolve, remainingTime));
            }
            
            document.getElementById('loading').classList.remove('show');
            document.getElementById('recommendBtn').disabled = false;
            
            // Stop rotating tips
            if (tipInterval) {
                clearInterval(tipInterval);
                tipInterval = null;
            }
        }
        
        async function getRecommendation() {
            const minutes = getCurrentMinutes();
            const mood = document.getElementById('mood').value;
            
            // Handle 3+ hours case
            if (minutes === 999) {
                showTouchGrassModal();
                return; // Don't make API call for marathon sessions
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_URL}/recommendations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        availableMinutes: parseInt(minutes),
                        desiredMood: mood
                    })
                });
                
                const data = await response.json();
                await hideLoading(); // Now waits for minimum time
                displayRecommendation(data);
            } catch (error) {
                await hideLoading(); // Wait even on error
                alert('Error connecting to backend. Make sure it\'s running!');
                console.error(error);
            }
        }
        
        function displayRecommendation(data) {
            currentGameId = data.game.id;
            
            document.getElementById('gameTitle').textContent = data.game.name;
            document.getElementById('reason').textContent = data.reason;
            document.getElementById('gameTime').textContent = 
                `${data.game.minMinutes}-${data.game.maxMinutes} minutes`;
            document.getElementById('gameMood').textContent = 
                data.game.moodTags.join(', ');
            
            document.getElementById('result').classList.add('show');
        }
        
        async function submitFeedback(score) {
            if (!currentGameId) return;
            
            try {
                await fetch(`${API_URL}/sessions/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        gameId: currentGameId,
                        satisfactionScore: score
                    })
                });
                
                alert(`Thanks for your feedback! (${score}/5)`);
            } catch (error) {
                alert('Error submitting feedback');
                console.error(error);
            }
        }
    </script>
</body>
</html>
